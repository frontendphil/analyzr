{% extends "base.html" %}

{% block content %}
    <div class='repos'>
        <table class="table">
            <thead>
                <tr>
                    <th></th>
                    <th>Type</th>
                    <th>Location</th>
                    <th>Revisions</th>
                    <th>Authors</th>
                    <th></th>
                </tr>
            </thead>
            <tbody>
                {% for repo in repositories %}
                    <tr>
                        <td class='status'>
                            {% if repo.analyzing %}
                                <i class='icon-refresh icon-spin'></i>
                            {% else %}
                                {% if repo.analyzed %}
                                    <i class='icon-ok'></i>
                                {% else %}
                                    <i class='icon-question'></i>
                                {% endif %}
                            {% endif %}
                        </td>
                        <td>{{ repo.kind }}</td>
                        <td>
                            {% if repo.analyzing %}
                                {{ repo.url }}
                            {% else %}
                                <a href='{% url "parsr.views.repo" id=repo.pk %}'>
                                    {{ repo.url }}
                                </a>
                            {% endif %}
                        </td>
                        <td>{{ repo.revision_count }}</td>
                        <td>{{ repo.author_count }}</td>
                        <td>
                            {% if repo.analyzing %}
                                Analyzing...
                            {% else %}
                                <div class="btn-group">
                                    {% if not repo.analyzed %}
                                        <button type="button" class='btn btn-primary btn-sm dropdown-toggle' data-toggle="dropdown">Analyze <span class="caret"></span></button>
                                    {% else %}
                                        <button type="button" class='btn btn-default btn-sm dropdown-toggle' data-toggle="dropdown">Re-Analyze <span class="caret"></span></button>
                                    {% endif %}

                                    <ul class='dropdown-menu' role="menu">
                                        {% for branch in repo.branch_set.all %}
                                            <li>
                                                <a href="#" rel="{% url 'parsr.views.analyze' repo_id=repo.pk branch_id=branch.pk %}" class="analyze">{{ branch.name }}</a>
                                            </li>
                                        {% endfor %}
                                    </ul>
                                </div>
                            {% endif %}
                        </td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
{% endblock %}
