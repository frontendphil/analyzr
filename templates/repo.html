{% extends "base.html" %}

{% load filters %}

{% block branch %}
    <i class='icon-code-fork'></i>
    <select data-repo="{{ repo.id }}" class='branch' value="{{ branch.id }}">
        {% for b in repo.branch_set.all %}
            {% if b.analyzed %}
                {% if b.id == branch.id %}
                    <option value='{{ b.id }}' selected='selected'>{{ b.name }}</option>
                {% else %}
                    <option value='{{ b.id }}'>{{ b.name }}</option>
                {% endif %}
            {% endif %}
        {% endfor %}
    </select>
{% endblock %}

{% block content %}
    <table class="table">
        <thead>
            <tr>
                <th colspan='3'>Repository</th>
                <th colspan='4' class='split'>Branch</th>
            </tr>
            <tr>
                <th>Location</th>
                <th>Branches</th>
                <th>Authors</th>
                <th class='split'>Name</th>
                <th>Last analyzed</th>
                <th>Age</th>
                <th>Authors</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td>{{ repo.url }}</td>
                <td>{{ repo.branch_count }}</td>
                <td>{{ repo.author_count }}</td>
                <td class='split'>{{ branch.name }}</td>
                <td>{{ branch.analyzed_date }}</td>
                <td>{{ branch.age }}</td>
                <td>{{ branch.author_count }}</td>
            </tr>
        </tbody>
    </table>

    <hr />

    <div
        class='stats'
        data-repo="{{ repo|href }}"
        data-branch="{{ branch|href }}"></div>

    <hr />

    <div
        class='contributors'
        data-repo='{{ repo|href }}'
        data-branch="{{ branch|href }}"></div>

    <hr />

    <div
        class='punchcard'
        data-repo='{{ repo|href }}'
        data-branch="{{ branch|href }}"></div>
{% endblock %}

{% block specific %}
    <script type="text/javascript">
        $(document).ready(function() {
            $("select.branch").change(function() {
                var branch = $(this).find("option:selected").attr("value");
                var repo = $(this).data("repo");

                window.location|href = "/repo/" + repo + "/branch/" + branch;
            });

            var contributors = new analyzr.plugins.Contributors(".contributors");
            contributors.load();
        });
    </script>
{% endblock %}

{% block script %}
    <script type="text/javascript">
        $(document).ready(function() {
            var punchcard = new analyzr.plugins.Punchcard(".punchcard");
            punchcard.load();

            var stats = new analyzr.plugins.FileStatistics(".stats");
            stats.load();
        });
    </script>
{% endblock %}
