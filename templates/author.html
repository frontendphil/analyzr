{% extends "repo.html" %}

{% load filters %}

{% block branch %}
    <h5>
        <i class='icon-code-fork'></i>
        {{ branch.name }}
    </h5>
{% endblock %}

{% block content %}

    <a href='{% url "parsr.views.repo" repo_id=branch.repo.id branch_id=branch.id %}'>
        <i class='icon-angle-left'></i> Back to repo
    </a>

    <h1>
        {% gravatar author.email %}
        {{ author.name }}

        {% if author.email %}
            <small>({{ author.email }})</small>
        {% endif %}
    </h1>

    <hr />

    <div
        class='stats'
        data-author="{{ author.href }}"
        data-branch="{{ branch.href }}"></div>

    <hr />

    {% if branch.measured %}
        <div
            class='metrics'
            data-author="{{ author.href }}"
            data-branch="{{ branch.href }}">

            <form class='form-inline' role='form'>
                <div class='filters col-lg-10 col-md-10'>
                    <div class='input-group date-from col-lg-3 col-md-3' data-rel='from' >
                        <input type='text' id='date-from' class='form-control' readonly/>
                        <span class='input-group-addon'>
                            <i class='icon-calendar'></i>
                        </span>
                    </div>

                    <div class='input-group date-to col-lg-3 col-md-3' data-rel='to'>
                        <input type='text' class='form-control' readonly/>
                        <span class='input-group-addon'>
                            <i class='icon-calendar'></i>
                        </span>
                    </div>
                </div>

                <div class='col-lg-2 col-md-2'>
                    <button class='btn btn-default update-filters'>Update</button>
                </div>
            </form>
        </div>

        <hr />

        <div
            class='churn'
            data-author="{{ author.href }}"
            data-branch="{{ branch.href }}"></div>

        <hr />
    {% endif %}

    <div
        class="commits"
        data-author="{{ author.href }}"
        data-branch="{{ branch.href }}"></div>

    <hr />

    <div
        class='punchcard'
        data-author="{{ author.href }}"
        data-branch="{{ branch.href }}"></div>

{% endblock %}

{% block specific %}{% endblock %}

{% block script %}
    {{ block.super }}

    <script type="text/javascript">
        $(document).ready(function() {
            var metrics = new Metrics(".metrics", {
                height: 400,
                margins: {
                    top: 40,
                    left: 100,
                    right: 100,
                    bottom: 40
                }
            });
            metrics.load();

            var churn = new CodeChurn(".churn", {
                height: 300,
                margins: {
                    top: 20,
                    left: 40,
                    bottom: 40
                }
            });
            churn.load();
        });
    </script>
{% endblock %}
