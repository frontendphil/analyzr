{% extends "repo.html" %}

{% load filters %}

{% block branch %}
    <h5>
        <i class='icon-code-fork'></i>
        {{ branch.name }}
    </h5>
{% endblock %}

{% block breadcrumb %}
    {{ block.super }}

    <li>
        <a href='{% url "parsr.views.branch.view" branch_id=branch.id %}'>{{ branch.repo.url }}</a>
    </li>
{% endblock %}

{% block active%}
    <li class='active'>{{ author.name }}</li>
{% endblock %}

{% block content %}
    <h1>
        {% gravatar author.email %}
        {{ author.name }}

        {% if author.email %}
            <small>({{ author.email }})</small>
        {% endif %}
    </h1>

    <select class='compare'>
        <option>Compare To</option>

        {% with author as current_author %}
            {% for author in branch.authors %}
                {% if not author == current_author %}
                    <option value="{{ author|href }}">{{ author.name }}</option>
                {% endif %}
            {% endfor %}
        {% endwith %}
    </select>

    <hr />

    {% include "includes/metrics.html" %}

{% endblock %}

{% block specific %}
    <script type="text/javascript">
        $(document).ready(function() {
            $(".compare").change(function() {
                var author = $(this).val();

                window.location.href = "{{ branch|href }}{{ author|href }}/compare" + author;
            });
        });
    </script>
{% endblock %}

{% block script %}
    {{ block.super }}

    <script type="text/javascript">
        $(document).ready(function() {
            $(".score").each(function() {
                var score = new analyzr.plugins.Score(this);
                score.load();
            });

            $(".metrics.complexity").each(function() {
                var complexity = new analyzr.plugins.graph.metrics.ComplexityMetrics(this, {
                    height: 400,
                    margins: {
                        top: 40,
                        left: 100,
                        right: 100,
                        bottom: 40
                    }
                });
                complexity.load();
            });

            $(".metrics.structure").each(function() {
                var structure = new analyzr.plugins.graph.metrics.StructuralMetrics(this, {
                    height: 400,
                    margins: {
                        top: 40,
                        left: 100,
                        right: 100,
                        bottom: 40
                    }
                });
                structure.load();
            });

            $(".churn").each(function() {
                var churn = new analyzr.plugins.graph.CodeChurn(this, {
                    height: 300,
                    margins: {
                        top: 20,
                        left: 40,
                        bottom: 40
                    }
                });
                churn.load();
            });
        });
    </script>
{% endblock %}
